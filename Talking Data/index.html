<!DOCTYPE html>
<meta charset='utf-8'>
<html>
<title>Prediction Wizard</title>
  <link rel='stylesheet' href='style.css'>
  <style>
  .bar {
      fill: steelblue;
    }

    .bar:hover {
      fill: brown;
    }

    .axis--x path {
      display: none;
    }
        #tooltip {
            font-family: sans-serif;
            color: #454545;
        }

        #dropdowns {
            margin-bottom: 20px;
            margin-right: 35px;
        }

        h3, h5 {
            margin: 0;
        }
        body {
       font-family: Verdana,Arial,sans-serif;
     }

     h2 {
       font-size: 1.2em;
       margin: 60px 0 5px 0;
       color: gray
     }

     .space {
       margin-bottom: 20 px;
     }

     .wrapper {
       width: 800px;
       margin-left: auto;
       margin-right: auto;
       margin-bottom: 0px;
     }

     #bar_chart {
       margin-bottom: 0 px;
     }

     .bar {
       fill: #FF75A3;
     }

     span {
       color: steelblue;
     }

    #tooltip {
          font-family: sans-serif;
          color: #454545;
      }

    #dropdown {
        margin-bottom: 20px;
        margin-right: 35px;
      }

    h3, h5 {
         margin: 0;
       }

    </style>
    <head>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src = "drop_down.js"></script>
  </head>
  <body>
<div id="chart_area" class="wrapper">
      <h2>Age and Gender Bracket Probabilities</h2>
      <p class="space"></p>
      <div id="bar_chart">
      </div>
  </div>

  <div id="dropdown" class="wrapper">
    <h2 class="feature">Brand: <span id="brand">Huawei</span></h2>
    <div id="brand_dropdown"><select id="dropdown1"></select></div>

    <h2 class="feature">Model: <span id="model">Q</span></h2>
    <div id="model_dropdown"><select id="dropdown2"></select></div>

    <h2 class="feature">City: <span id="city">Dalian</span></h2>
    <div id="city_dropdown">  <select id="dropdown3"></select></div>
  </div>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src = "drop_down.js"></script>
  <script src = "mod_dd.js"></script>
  <script src = "citydd.js"></script>
  <svg width="960" height="500"></svg>
<body>


    <script>

        // populate drop-down
        d3.select("#dropdown1")
          .selectAll("option")
          .data(drop_down)
          .enter()
          .append("option")
          .attr("value", function(option) { return option.value; })
          .text(function(option) { return option.text; });
          // populate drop-down
          d3.select("#dropdown2")
            .selectAll("option")
            .data(d_dd)
            .enter()
            .append("option")
            .attr("value", function(option) { return option.value; })
            .text(function(option) { return option.text; });
            // populate drop-down
            d3.select("#dropdown3")
              .selectAll("option")
              .data(appdd)
              .enter()
              .append("option")
              .attr("value", function(option) { return option.value; })
              .text(function(option) { return option.text; });

        // initial dataset on load
        var selected_dataset = "Huawei";
        var current_brand = 'Huawei';
        var current_model = 'Mi 3';
        var current_city = 'Dalian';
        var current_risk = 97.0;

        var w = 700,
            h = 650;

        // dropdown dataset selection
        var dropDown = d3.select("#dropdown1");
        var dropDown2 = d3.select("#dropdown2");
        var dropDown3 = d3.select("#dropdown3");
        dropDown.on("change", function() {

          current_brand = d3.event.target.value;
          new_label = d3.event.target.text;
          d3.select('#brand').text(new_label);
          getAndDrawChance(current_brand, current_model, current_city)
        });
        dropDown2.on("change", function() {

          current_model = d3.event.target.value;
          new_label = d3.event.target.text;
          d3.select('#model').text(new_label);
          getAndDrawChance(current_brand, current_model, current_city)
        });
        dropDown3.on("change", function() {

          current_city = d3.event.target.value;
          new_label = d3.event.target.text;
          d3.select('#city').text(new_label);
          getAndDrawChance(current_brand, current_model, current_city)
        });


        var chart = d3.select("#bar_chart")
                           .append("svg:svg")
                           .attr("width", 800)
                           .attr("height", 100);

             var chance_scale = d3.scale.linear()
                                        .domain([0, 100])
                                        .range([0, 800]);

             var bar = chart.append("g")
                            .attr("class", "bar")

               bar.append("svg:rect")
                  .attr("id", "chancebar")
                  .attr("class", "bar")
                  .attr("width", chance_scale(current_risk))
                  .attr("height", 50);

             bar.append("text")
                .attr("id", "percent_text")
                .attr("dy", ".75em")
                .attr("y", 15)
                .attr("x", chance_scale(current_risk-5))
                .attr("text-anchor", "middle")
                .attr("fill", "white")
                .attr("font-size", 20)
                .text( current_risk.toFixed(1) + "%");


     <!-- FUNCTION TO GET CHANCE FROM YOUR PREDICTOR WITH AsynchronsJavescriptAndXml, reduces overhead of communicating, AND CHANGE BAR  HEIGHT -->
             function getAndDrawChance(age, year, nodes){

               $.ajax({
                 type: "POST",
                 contentType: "application/json; charset=utf-8",
                 url: "/score",
                 dataType: "json",
                 async: true,
                 data: "{\"example\": ["+age+","+year+","+nodes+"0]}",
                 success: function (data) {
                   var chance = 100 * data["score"];
                   d3.select("#chancebar")
                     .attr("width", chance_scale(chance));
                   d3.select("#percent_text")
                     .attr("x", chance_scale(chance-5))
                     .text(chance.toFixed(1) + "%");
                 },
                 error: function (result) {
                 }
               })
             }

      <!-- BAR PLOT -->
  var svg = d3.select("svg"),
    margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = +svg.attr("width") - margin.left - margin.right,
    height = +svg.attr("height") - margin.top - margin.bottom;

var x = d3.scaleBand().rangeRound([0, width]).padding(0.1),
    y = d3.scaleLinear().rangeRound([height, 0]);

var g = svg.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

d3.tsv("data.tsv", function(d) {
  d.frequency = +d.frequency;
  return d;
}, function(error, data) {
  if (error) throw error;

  x.domain(data.map(function(d) { return d.letter; }));
  y.domain([0, d3.max(data, function(d) { return d.frequency; })]);

  g.append("g")
      .attr("class", "axis axis--x")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));

  g.append("g")
      .attr("class", "axis axis--y")
      .call(d3.axisLeft(y).ticks(10, "%"))
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", "0.71em")
      .attr("text-anchor", "end")
      .text("Frequency");

  g.selectAll(".bar")
    .data(data)
    .enter().append("rect")
      .attr("class", "bar")
      .attr("x", function(d) { return x(d.letter); })
      .attr("y", function(d) { return y(d.frequency); })
      .attr("width", x.bandwidth())
      .attr("height", function(d) { return height - y(d.frequency); });
});

    // references
    // [1] http://stackoverflow.com/questions/17671252/d3-create-a-continous-color-scale-with-many-strings-inputs-for-the-range-and-dy

    </script>
</body>
</html>
